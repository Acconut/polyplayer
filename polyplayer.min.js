!function(t){var e=function s(t){var e={provider:null,videoId:null,videoUrl:null,prefetchInfo:!1,container:document.body};if(_.extend(e,t),e.videoUrl){var i=this._parseUrl(e.videoUrl);_.extend(e,i)}return e.container instanceof Element||(e.container=document.querySelector(e.container)),e.playerId=s._generatePlayerId(),new this._providers[e.provider](e)};e.prototype._providers={youtube:null,vimeo:null,soundcloud:null},e.prototype._parseUrl=function(t){var e={provider:null,videoUrl:null,videoId:null};try{var i=/^(https?:\/\/)?(www.)?([a-z0-9\-]+)\.[a-z]+(\/(.*))?/i.exec(t);if(null===i)throw"Invalid url";var n=i[3].toLowerCase(),s=i[5]||"";if(!(n in this._providers))throw"Unknown provider";if(e.provider=n,e.videoUrl=t,"youtube"===n){var r=/v=([A-Za-z0-9\-_]+)/.exec(t);if(null===r)throw"YouTube requires a URL containing the video ID (v)";e.videoId=r[1]}else if("vimeo"===n){if(!/^[0-9]+$/.test(s))throw"Vimeo must be a numeric video url";e.videoId=parseInt(s,10)}else if("soundcloud"===n){if(/^[0-9a-zA-Z-_]+\/sets\/[0-9a-zA-Z-_]+$/i.test(s))throw"Soundcloud sets are not implemented yet";if(!/^[0-9a-zA-Z-_]+\/[0-9a-zA-Z-_]+$/i.test(s))throw"This is not a valid url to a song on Soundcloud"}}catch(a){throw a}return e},e._lastPlayerId=0,e._generatePlayerId=function(){return"polyplayer_"+this._lastPlayerId++},e.states={LOADING:0,READY:1,PLAYING:2,PAUSED:3,FINISHED:4,STOPPED:5};var i=Backbone.Model.extend({defaults:{rawDetails:null,details:null,videoId:null,videoUrl:null,playerId:null,state:e.states.LOADING,currentPosition:null,duration:null},_setState:function(t){var i=e.states[t.toUpperCase()];this.set("state",i),this.trigger("stateChange",i)},_setCurrentPosition:function(t){this.set("currentPosition",t),this.trigger("playProgress",{currentPosition:t,relativePosition:t/this.get("duration")})},seek:function(t){var e=this;this.getDetails(function(i){e.seekTo(t*i.duration)})},getDetails:function(t){if(this.get("state")===e.states.LOADING)return this.on("ready",_.bind(this.getDetails,this,t)),void 0;var i=this.get("details");if(null!==i)return t(i);var n=this;this._fetchDetails(function(e){n.set("details",e),t(e)})},getCurrentPosition:function(){return this.get("currentPosition")},getDuration:function(){return this.get("duration")},getState:function(){return this.get("state")}});e.prototype._providers.soundcloud=i.extend({initialize:function(t){this.set({playerId:t.playerId,url:t.videoUrl,videoId:t.videoId});var e=document.createElement("iframe");e.setAttribute("id",t.playerId),e.setAttribute("src","https://w.soundcloud.com/player/?url="+encodeURIComponent(t.videoUrl)),t.container.appendChild(e);var i=this.widget=SC.Widget(e);i.bind(SC.Widget.Events.READY,_.bind(this._onReady,this)),i.bind(SC.Widget.Events.PAUSE,_.bind(this._onPause,this)),i.bind(SC.Widget.Events.PLAY,_.bind(this._onPlay,this)),i.bind(SC.Widget.Events.FINISH,_.bind(this._onFinish,this)),i.bind(SC.Widget.Events.PLAY_PROGRESS,_.bind(this._onPlayProgress,this))},play:function(){this.widget.play()},pause:function(){this.widget.pause()},seekTo:function(t){this.widget.seekTo(t),this._setCurrentPosition(t)},stop:function(){this.pause(),this.seek(0),this._setCurrentPosition(0);var t=this;setTimeout(function(){t._setState("stopped"),t.trigger("stop")},100)},_fetchDetails:function(t){this.widget.getCurrentSound(_.bind(function(e){this.set("rawDetails",e);var i={duration:e.duration,id:e.id,title:e.title,createdAt:new Date(e.created_at),thumbnails:[{width:100,height:100,url:e.artwork_url}]};this.set("details",i),t(i)},this))},_onReady:function(){var t=this;this.widget.getDuration(function(e){t.set("duration",e),t._setState("ready"),t.trigger("ready")})},_onPause:function(){this._setState("paused"),this.trigger("pause")},_onPlay:function(){this._setState("playing"),this.trigger("play")},_onFinish:function(){this.stop(),this._setState("finished"),this.trigger("finish")},_onPlayProgress:function(t){this.set("currentPosition",t.currentPosition),this.trigger("playProgress",t)}}),e.prototype._providers.youtube=i.extend({initialize:function(e){this.set({playerId:e.playerId,url:e.videoUrl,videoId:e.videoId});var i=document.createElement("div");i.setAttribute("id",e.playerId),e.container.appendChild(i);var n=this,s=function(){n.player=new YT.Player(e.playerId,{videoId:e.videoId,events:{onStateChange:function(t){n._setStateById(t.data)},onReady:function(){n._onReady()}}})};if("YT"in t)s();else{var r=document.createElement("script");r.src="https://www.youtube.com/iframe_api";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a),onYouTubeIframeAPIReady._callbacks.push(s)}this.on("play",this._setInterval),this.on("pause",this._clearInterval),this.on("finish",this._clearInterval)},_onReady:function(){this.set("duration",1e3*this.player.getDuration()),this._setState("ready"),this.trigger("ready")},play:function(){this.get("state")===e.states.STOPPED&&this.seekTo(0),this.player.playVideo()},pause:function(){this.player.pauseVideo()},stop:function(){this.player.stopVideo(),this.pause(),this._setCurrentPosition(0),this._setState("stopped"),this.trigger("stop")},seekTo:function(t){if(this._seekValue=t,this._setCurrentPosition(t),!this._seekTimeoutSet){this._seekTimeoutSet=!0;var e=this;setTimeout(function(){var t=e._seekValue;e.player.seekTo(t/1e3,!0),e._seekTimeoutSet=!1},500)}},_seekValue:null,_seekTimeoutSet:!1,_setInterval:function(){var t=this;this._intervalId=setInterval(function(){var e=t.player.getCurrentTime();t._setCurrentPosition(1e3*e)},1e3)},_clearInterval:function(){clearInterval(this._intervalId),this._intervalId=null},_fetchDetails:function(t){var e=this,i=new XMLHttpRequest;i.onload=function(i){var n=i.target.responseText;try{n=JSON.parse(n).entry}catch(s){throw s}e.set("rawDetails",n);var r={title:n.title.$t,duration:1e3*parseInt(n.media$group.yt$duration.seconds),thumbnails:[],createdAt:new Date(n.published.$t)};_.each(n.media$group.media$thumbnail,function(t){r.thumbnails.push({height:t.height,width:t.width,url:t.url})}),e.set("details",r),t(r)},i.open("get","https://gdata.youtube.com/feeds/api/videos/"+this.get("videoId")+"?v=2&alt=json",!0),i.send()},_setStateById:function(t){var e={"-1":"loading",0:"finished",1:"playing",2:"paused",3:null,5:"ready"},i=e[t];null!==i&&(this._setState(i),"playing"===i?this.trigger("play"):"paused"==i?this.trigger("pause"):"finished"==i&&this.trigger("finish"))}}),t.onYouTubeIframeAPIReady&&console&&console.log&&console.log("[Polyplayer] There is already a function `onYouTubeIframeAPIReady` declared. It will be overwritten"),t.onYouTubeIframeAPIReady=function(){for(var t=0;t<onYouTubeIframeAPIReady._callbacks.length;t++)onYouTubeIframeAPIReady._callbacks[t]()},t.onYouTubeIframeAPIReady._callbacks=[],e.prototype._providers.vimeo=i.extend({initialize:function(t){this.set({playerId:t.playerId,url:t.videoUrl,videoId:t.videoId});var e=document.createElement("iframe");e.setAttribute("id",t.playerId),e.setAttribute("src","http://player.vimeo.com/video/"+t.videoId+"?api=1&player_id="+t.playerId),t.container.appendChild(e);var i=this.player=$f(e),n=this;i.addEvent("ready",function(){i.api("getDuration",function(t){n.set("duration",parseInt(1e3*t)),n._setState("ready"),n.trigger("ready")}),i.addEvent("playProgress",function(t){n.trigger("progress",{relativePosition:t.percent})}),i.addEvent("play",function(){n.trigger("play"),n._setState("playing")}),i.addEvent("pause",function(){n.trigger("pause"),n._setState("paused")}),i.addEvent("finish",function(){n.stop(),n._setState("finished"),n.trigger("finish")}),i.addEvent("playProgress",function(t){n.set("currentPosition",1e3*t.seconds),n.trigger("playProgress",{currentPosition:1e3*t.seconds,relativePosition:t.percent})})})},play:function(){this.player.api("play")},pause:function(){this.player.api("pause")},seekTo:function(t){this.player.api("seekTo",t/1e3),this._setCurrentPosition(t)},stop:function(){this.pause(),this.seek(0),this._setCurrentPosition(0),this._setState("stopped"),this.trigger("stop")},_fetchDetails:function(t){var e=this,i=new XMLHttpRequest;i.onload=function(i){var n=i.target.responseText;try{n=JSON.parse(n)[0]}catch(s){throw s}e.set("rawDetails",n);var r=/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})/.exec(n.upload_date),a=new Date(r[1],r[2]-1,r[3],r[4],r[5],r[6]),o={title:n.title,duration:1e3*parseInt(n.duration),thumbnails:[{width:100,height:100,url:n.thumbnail_small},{width:200,height:200,url:n.thumbnail_medium},{width:640,height:640,url:n.thumbnail_large}],createdAt:a};e.set("details",o),t(o)},i.open("get","http://vimeo.com/api/v2/video/"+this.get("videoId")+".json",!0),i.send()}});var n={};n.Player=e,t.PP=n}(window);